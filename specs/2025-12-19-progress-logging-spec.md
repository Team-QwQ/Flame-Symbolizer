# resolve-stacks 进度日志增强规范

## 背景与问题
- `resolve-stacks.sh` 在执行 `first_pass_collect`、`run_batch_symbolization`、`second_pass_emit` 三个阶段时，当前仅在 `--debug` 下输出零星调试信息，没有阶段性进度反馈。
- 当输入较大（堆栈折叠文件、模块较多）时，用户在 debug 模式下缺乏“已处理/总处理”提示，不利于确认脚本是否卡住或仍在推进。

## 目标
- 在 `--debug` 开启时，为三个主要阶段增加简洁的阶段性进度/计数日志，帮助用户观察处理推进。
- 保持默认非 debug 路径无输出变化，不影响性能或结果。

## 非目标
- 不改动业务逻辑、批处理策略或性能行为。
- 不改变输出格式（除了 `--debug` 模式下新增的日志）。
- 不新增 CLI 选项。

## 需求与约束
- 仅在 `DEBUG_MODE=1` 时输出，正常模式静默。
- 输出内容包含“已处理/总计”或等价可读信息，覆盖：
  - `first_pass_collect`：遍历输入行的进度，基于行计数输出阶段性统计。
  - `run_batch_symbolization`：按已完成批次数/总批次数或已处理地址数量。
  - `second_pass_emit`：输出行的进度。
- 日志应简洁，避免每行输出过于频繁；可采用定期（如每 N 行/批）打印或阶段开始/结束汇总。
- 保持现有调试日志风格（使用 `debug_log`），不引入新依赖。

## 方案草案
- 复用 `debug_log` 输出，新增阶段性的计数日志；频率采用固定步长（如每 10k 行/帧/批）或在阶段结束时打印汇总。
- 复用现有计数器（如 `LINES_PROCESSED`、`BATCH_CALLS`）或新增轻量局部计数器，避免污染全局状态。
- 在三个函数内部添加进度打印逻辑，确保不会在失败路径破坏现有警告/错误处理。

## 验收标准
- 在 `--debug` 模式运行示例输入时，stderr 出现三个阶段的进度/汇总日志，格式清晰可识别；正常模式无新增输出。
- 新日志不会显著增加输出量（例如大文件下按步长输出，且有收尾汇总）。
- 所有现有测试/脚本仍可通过（无行为回归）。
